transform the state checkpoint to hooks